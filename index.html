<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screener Pro - Ultimate</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #f4f6f9; }
        .clickable-row:hover { background-color: #f1f3f5 !important; cursor: pointer; }
        .kode-saham-btn { text-decoration: none; color: #0d6efd; font-weight: 700; }
        .kode-saham-btn:hover { text-decoration: underline; }
        .star-btn { cursor: pointer; font-size: 1.2rem; transition: transform 0.2s; }
        .star-btn:hover { transform: scale(1.2); color: #ffc107 !important; }
        
        /* Navbar Custom */
        .navbar { background: linear-gradient(90deg, #1a1e21 0%, #2c3e50 100%); }
        .nav-link-custom { color: #ccc; font-size: 0.85rem; font-weight: 600; cursor: pointer; text-decoration: none; transition: 0.3s; padding: 5px 10px; }
        .nav-link-custom:hover { color: #fff; background-color: rgba(255,255,255,0.1); border-radius: 4px; }

        /* Sticky & Scroll */
        .sticky-controls { position: sticky; top: 60px; z-index: 1020; background-color: #f4f6f9; padding-top: 10px; padding-bottom: 5px; margin-bottom: 10px; }
        .table th:first-child, .table td:first-child { position: sticky; left: 0; z-index: 20; background-color: #fff !important; border-right: 2px solid #dee2e6; }
        .table th:first-child { z-index: 30; background-color: #f8f9fa !important; }
        #search-results { max-height: 250px; overflow-y: auto; position: absolute; width: 100%; z-index: 1060; border-radius: 0 0 8px 8px; }
    </style>
</head>
<body>

    <nav class="navbar navbar-dark shadow-sm sticky-top py-2">
        <div class="container d-flex justify-content-between align-items-center">
            <a class="navbar-brand fw-bold text-warning m-0 p-0" href="#" style="font-size: 1.2rem;">
                SCREENER PRO <span class="badge bg-light text-dark ms-1" style="font-size: 9px; vertical-align: middle;">LITE</span>
            </a>
            <div class="d-flex align-items-center gap-2">
                <a class="nav-link-custom" href="#" onclick="window.openStrategyModal(); return false;">‚öôÔ∏è STRATEGY</a>
                <a class="nav-link-custom" href="#" onclick="document.getElementById('csv-file-input').click(); return false;">üìÇ UPLOAD</a>
                <a class="nav-link-custom text-danger" href="#" id="btn-logout">LOGOUT</a>
            </div>
            <input type="file" id="csv-file-input" accept=".csv" style="display: none;">
        </div>
    </nav>

    <div class="container mt-3">
        
        <div id="status-alert" class="alert alert-secondary d-none mb-3 shadow-sm py-2 small" role="alert"></div>

        <div class="row mb-3" id="market-overview-area" style="display:none;">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-dark text-white py-2 d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center gap-2" style="max-width: 70%;">
                            <span class="small text-white-50 d-none d-md-inline">Tampilkan:</span>
                            <select id="market-view-select" class="form-select form-select-sm fw-bold bg-secondary text-white border-0" style="cursor:pointer;" onchange="window.triggerRender()">
                                <option value="ai_picks">üî• AI Top Picks (Strategy)</option>
                                <option value="gainers">üöÄ Top Gainers</option>
                                <option value="losers">üîª Top Losers</option>
                                <option value="volume">üîä Top Volume</option>
                                <option value="frequency">‚ö° Top Frequency</option>
                                <option value="foreign">üí∞ Foreign Accumulation</option>
                                <option value="mcap">üè¶ Big Market Cap</option>
                            </select>
                        </div>
                        <span class="badge bg-warning text-dark" id="view-badge">Top 10</span>
                    </div>
                    <div class="card-body p-0">
                        <ul class="list-group list-group-flush" id="market-list-container"></ul>
                    </div>
                    <div class="card-footer bg-white text-center py-1">
                        <small class="text-muted" id="market-footer-info">Menampilkan 10 data teratas</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="sticky-controls">
            <div class="card shadow-sm border-0">
                <div class="card-body p-2 bg-white rounded">
                    <div class="row g-2">
                        <div class="col-md-6 position-relative">
                            <div class="input-group"> 
                                <span class="input-group-text bg-light border-end-0">üîç</span>
                                <input type="text" id="input-search" class="form-control border-start-0" placeholder="Cari Kode / Nama..." autocomplete="off">
                            </div>
                            <div id="search-results" class="list-group shadow d-none"></div>
                        </div>
                        <div class="col-md-6">
                            <div class="btn-group w-100 shadow-sm" role="group">
                                <input type="radio" class="btn-check" name="btnradio" id="filter-all" autocomplete="off" checked onclick="setFilter('ALL')">
                                <label class="btn btn-outline-secondary fw-semibold" for="filter-all">Semua</label>
                                
                                <input type="radio" class="btn-check" name="btnradio" id="filter-watchlist" autocomplete="off" onclick="setFilter('WATCHLIST')">
                                <label class="btn btn-outline-warning fw-semibold" for="filter-watchlist">‚≠ê Watch</label>
                                
                                <input type="radio" class="btn-check" name="btnradio" id="filter-owned" autocomplete="off" onclick="setFilter('OWNED')">
                                <label class="btn btn-outline-primary fw-bold" for="filter-owned">üíº Porto</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card shadow-sm mb-4">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0 text-nowrap">
                        <thead class="table-light small">
                            <tr>
                                <th onclick="sortTable(0)" style="cursor:pointer;">Kode ‚áÖ</th>
                                <th onclick="sortTable(1)" style="cursor:pointer;">Close ‚áÖ</th>
                                <th onclick="sortTable(2)" style="cursor:pointer;" class="text-end">Fund ‚áÖ</th> 
                                <th onclick="sortTable(3)" style="cursor:pointer;" class="text-center">Tren Harian ‚áÖ</th>
                                <th onclick="sortTable(4)" style="cursor:pointer;" class="text-end">Chg% ‚áÖ</th>
                                <th onclick="sortTable(5)" style="cursor:pointer;" class="text-center">Sinyal ‚áÖ</th>
                            </tr>
                        </thead>
                        <tbody id="table-body" class="small"></tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer bg-white text-muted text-center py-2 small" id="footer-info">Menunggu data...</div>
        </div>

    </div> 

    <div class="modal fade" id="portfolioModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-fullscreen-md-down">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white py-2">
                    <div>
                        <h5 class="modal-title fw-bold" id="modal-kode-saham">CODE</h5>
                        <small id="modal-nama-perusahaan" class="text-white-50" style="font-size: 0.75rem;">Nama Perusahaan</small>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="price-chart" class="mb-1 border rounded p-1 bg-white" style="height: 250px; position: relative;"></div>
                    <div id="stoch-chart" class="mb-2 border rounded p-1 bg-white" style="height: 120px; position: relative;"></div>

                    <div class="card bg-light border-0 mb-3">
                        <div class="card-body p-2">
                            <h6 class="fw-bold small text-muted mb-2">ü§ñ Advanced Tech Analysis</h6>
                            <div class="row g-2" style="font-size: 0.75rem;">
                                <div class="col-4 border-end"><span class="d-block text-secondary">Pivot (P):</span><span id="tech-pivot" class="fw-bold">-</span></div>
                                <div class="col-4 border-end"><span class="d-block text-secondary">Res (R1):</span><span id="tech-r1" class="fw-bold text-danger">-</span></div>
                                <div class="col-4"><span class="d-block text-secondary">Supp (S1):</span><span id="tech-s1" class="fw-bold text-success">-</span></div>
                                <div class="col-4 border-end border-top pt-1"><span class="d-block text-secondary">OBV:</span><span id="tech-obv" class="fw-bold">-</span></div>
                                <div class="col-4 border-end border-top pt-1"><span class="d-block text-secondary">Cross:</span><span id="tech-cross" class="fw-bold">-</span></div>
                                <div class="col-4 border-top pt-1"><span class="d-block text-secondary">Stoch:</span><span id="tech-stoch" class="fw-bold">-</span></div>
                            </div>
                        </div>
                    </div>

                    <form id="portfolio-form">
                        <input type="hidden" id="input-kode">
                        <div class="row mb-2">
                            <div class="col-6"><label class="form-label small text-muted mb-0">Avg Price</label><input type="number" id="input-avg" class="form-control form-control-sm fw-bold" placeholder="0" required></div>
                            <div class="col-6"><label class="form-label small text-muted mb-0">Lot</label><input type="number" id="input-lots" class="form-control form-control-sm" value="1" required></div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6"><label class="form-label small text-muted mb-0">TP (%)</label><div class="input-group input-group-sm"><span class="input-group-text bg-success text-white">+</span><input type="number" id="input-tp-pct" class="form-control border-success"></div><div class="form-text text-success small m-0" id="calc-tp">-</div></div>
                            <div class="col-6"><label class="form-label small text-muted mb-0">CL (%)</label><div class="input-group input-group-sm"><span class="input-group-text bg-danger text-white">-</span><input type="number" id="input-cl-pct" class="form-control border-danger"></div><div class="form-text text-danger small m-0" id="calc-cl">-</div></div>
                        </div>
                        <div class="mb-2 form-check"><input type="checkbox" class="form-check-input" id="input-watchlist"><label class="form-check-label small" for="input-watchlist">‚≠ê Watchlist</label></div>
                        <div class="mb-2"><textarea id="input-notes" class="form-control form-control-sm" rows="1" placeholder="Catatan..."></textarea></div>
                        <div class="d-grid gap-2"><button type="submit" class="btn btn-primary btn-sm">üíæ Simpan Plan</button><button type="button" class="btn btn-outline-danger btn-sm" id="btn-delete-portfolio" style="display:none;">Hapus</button></div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="strategyModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title fs-6">‚öôÔ∏è Konfigurasi Strategi</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="strategy-form">
                        <div class="mb-3">
                            <label class="form-label small fw-bold">Pilih Profil Trading:</label>
                            <select id="strategy-preset" class="form-select" onchange="applyStrategyPreset()">
                                <option value="custom">üõ†Ô∏è Custom (Manual)</option>
                                <option value="conservative">üê¢ Konservatif (Swing)</option>
                                <option value="moderate">‚öñÔ∏è Moderat (Day Trade)</option>
                                <option value="aggressive">üöÄ Agresif (Scalping)</option>
                            </select>
                            <div class="form-text small fst-italic mt-1" id="strategy-desc">Deskripsi strategi...</div>
                        </div>
                        <hr>
                        <div class="row g-2">
                            <div class="col-6"><h6 class="small fw-bold text-muted border-bottom pb-1">üí∞ Risk Management</h6><div class="mb-2"><label class="form-label small mb-0">TP (%)</label><input type="number" id="default-tp" class="form-control form-control-sm"></div><div class="mb-2"><label class="form-label small mb-0">CL (%)</label><input type="number" id="default-cl" class="form-control form-control-sm"></div></div>
                            <div class="col-6"><h6 class="small fw-bold text-muted border-bottom pb-1">üìà Indikator Chart</h6><div class="mb-2"><label class="form-label small mb-0">MA Period</label><input type="number" id="default-ma" class="form-control form-control-sm"></div><div class="mb-2"><label class="form-label small mb-0">RSI Period</label><input type="number" id="default-rsi" class="form-control form-control-sm"></div></div>
                        </div>
                        <button type="submit" class="btn btn-warning w-100 mt-3">Simpan</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="script.js"></script>

</body>
</html>
